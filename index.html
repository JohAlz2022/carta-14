<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Para mi persona favorita üíò</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="fade-in">
  <div class="bg"></div>
  <div class="hearts"></div>

  <!-- Audio global (se reanuda por localStorage) -->
  <audio id="bgm" preload="auto" loop>
    <source src="audio/uwaie.mp3" type="audio/mpeg">
    <!-- Si NO renombraste, usa esto en vez de arriba:
    <source src="audio/UWAIE%20-%20Kapo%20%28Video%20Oficial%29.mp3" type="audio/mpeg">
    -->
  </audio>

  <main class="page">
    <div class="container">
      <section class="card">
        <p class="mini">Para ti mi amor</p>
        <h1>Lo mejor que me pas√≥ este a√±o‚Ä¶</h1>
        <p>te hice algo especial. Espero te guste. <b>Hecho con amor mi Dani</b> ü§ç</p>

        <div class="row" style="margin-top:18px;">
          <button class="btn primary pulse" id="goSorpresa">Ver sorpresa </button>
        </div>

        <div class="row" style="margin-top:12px;">
          <button class="btn secondary" id="toggleMusic">‚ñ∂ M√∫sica</button>
          <a class="btn" target="_blank" rel="noopener"
             href="https://open.spotify.com/search/UWAIE%20Kapo">Spotify</a>
          <a class="btn" target="_blank" rel="noopener"
             href="https://www.youtube.com/results?search_query=UWAIE+Kapo">YouTube</a>
        </div>

        <p style="margin-top:12px;">Mi Dani, abre esto con calma y con aud√≠fonos üòå</p>
      </section>
    </div>
  </main>

  <!-- Mini-player -->
  <div class="player">
    <button class="btn primary" id="playBtn">‚ñ∂</button>
    <small id="track">UWAIE - Kapo</small>
  </div>

  <script>
    // ===== Helpers =====
    function pageGo(url){
      document.body.classList.add('fade-out');
      setTimeout(()=> location.href = url, 240);
    }

    // ===== Audio persistente entre p√°ginas =====
    const audio = document.getElementById('bgm');
    const playBtn = document.getElementById('playBtn');
    const toggleMusic = document.getElementById('toggleMusic');

    function setUI(playing){
      playBtn.textContent = playing ? '‚è∏' : '‚ñ∂';
      toggleMusic.textContent = playing ? '‚è∏ M√∫sica' : '‚ñ∂ M√∫sica';
    }

    // restaurar estado
    const savedTime = Number(localStorage.getItem('bgm_time') || 0);
    const savedPlay = localStorage.getItem('bgm_play') === '1';
    if (!Number.isNaN(savedTime) && savedTime > 0) audio.currentTime = Math.min(savedTime, Math.max(0, audio.duration || savedTime));

    async function startMusic(){
      try{
        await audio.play();
        localStorage.setItem('bgm_play','1');
        setUI(true);
      }catch(e){
        // Autoplay bloqueado hasta que el usuario haga click, normal.
        setUI(false);
      }
    }
    function pauseMusic(){
      audio.pause();
      localStorage.setItem('bgm_play','0');
      setUI(false);
    }

    // si antes estaba reproduciendo, intenta arrancar (puede requerir interacci√≥n)
    if(savedPlay) startMusic(); else setUI(false);

    // guardar tiempo
    setInterval(()=> localStorage.setItem('bgm_time', String(audio.currentTime || 0)), 800);

    playBtn.addEventListener('click', ()=> audio.paused ? startMusic() : pauseMusic());
    toggleMusic.addEventListener('click', ()=> audio.paused ? startMusic() : pauseMusic());

    // Bot√≥n principal: inicia m√∫sica + navega
    document.getElementById('goSorpresa').addEventListener('click', async ()=>{
      if(audio.paused) await startMusic();
      pageGo('sorpresa.html');
    });

    // Primer click en la p√°gina: si estaba marcado como play, intenta arrancar
    window.addEventListener('pointerdown', ()=> {
      if(localStorage.getItem('bgm_play') === '1' && audio.paused) startMusic();
    }, { once:false });
  </script>
</body>
</html>
